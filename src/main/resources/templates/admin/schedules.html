<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
  <div th:fragment="content">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="mb-0">Qu·∫£n l√Ω L·ªãch t·∫≠p PT</h2>
    </div>

    <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
    <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

    <div class="row">
      <!-- C·ªôt b√™n tr√°i: Danh s√°ch PT -->
      <div class="col-md-4">
        <div class="card shadow-sm">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Danh s√°ch Hu·∫•n luy·ªán vi√™n</h5>
          </div>
          <div class="list-group list-group-flush" style="max-height: 80vh; overflow-y: auto;">
            <div th:if="${allPts == null or #lists.isEmpty(allPts)}" class="list-group-item text-muted text-center py-4">
              Ch∆∞a c√≥ hu·∫•n luy·ªán vi√™n n√†o
            </div>
            <a
              th:each="pt : ${allPts}"
              th:href="@{/admin/schedules(ptId=${pt.id})}"
              th:classappend="${selectedPtId != null and selectedPtId == pt.id} ? 'list-group-item-primary' : ''"
              class="list-group-item list-group-item-action"
              style="cursor: pointer; transition: all 0.2s;"
              onmouseover="this.style.backgroundColor='#f8f9fa'"
              onmouseout="this.style.backgroundColor=''"
            >
              <div class="d-flex justify-content-between align-items-center">
                <div class="flex-grow-1">
                  <div class="fw-bold mb-1" th:text="${pt.fullName}">PT Name</div>
                  <div class="small text-muted" th:text="${'üìû ' + pt.phoneNumber}">Phone</div>
                </div>
                <i
                  th:if="${selectedPtId != null and selectedPtId == pt.id}"
                  class="bi bi-check-circle-fill text-primary"
                  style="font-size: 1.5rem;"
                ></i>
              </div>
            </a>
          </div>
        </div>
      </div>

      <!-- C·ªôt b√™n ph·∫£i: L·ªãch t·∫≠p c·ªßa PT -->
      <div class="col-md-8">
        <div th:if="${selectedPt == null}" class="alert alert-info">
          <strong>üëà Ch·ªçn m·ªôt Hu·∫•n luy·ªán vi√™n</strong> t·ª´ danh s√°ch b√™n tr√°i ƒë·ªÉ xem l·ªãch t·∫≠p
        </div>

        <div th:if="${selectedPt != null}">
          <!-- Th√¥ng tin PT -->
          <div class="card shadow-sm mb-3 border-0">
            <div class="card-body bg-light rounded">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="card-title mb-0">
                  L·ªãch t·∫≠p c·ªßa: <span class="text-primary fw-bold" th:text="${selectedPt.fullName}">PT</span>
                </h5>
                <div class="text-muted small">
                  <i class="bi bi-telephone"></i> <span th:text="${selectedPt.phoneNumber}"></span>
                </div>
              </div>
              <div class="row g-3 text-center">
                <div class="col-md-4">
                  <div class="bg-white border rounded p-3 shadow-sm">
                    <h3 class="text-primary mb-1" th:text="${#lists.size(ptSessions)}">0</h3>
                    <div class="small text-muted">T·ªïng bu·ªïi t·∫≠p</div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="bg-white border rounded p-3 shadow-sm">
                    <h3 class="text-success mb-1">
                      <span
                        th:text="${#sets.size(#sets.toSet(ptSessions.![memberPackage.member.id]))}"
                        >0</span
                      >
                    </h3>
                    <div class="small text-muted">H·ªçc vi√™n</div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="bg-white border rounded p-3 shadow-sm">
                    <h3 class="text-info mb-1">
                      <span th:text="${#lists.size(ptSessions) > 7 ? 7 : #lists.size(ptSessions)}">0</span>
                    </h3>
                    <div class="small text-muted">7 bu·ªïi g·∫ßn ƒë√¢y</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- B·∫£ng l·ªãch t·∫≠p -->
          <div class="card shadow-sm border-0">
            <div class="card-header bg-white border-bottom">
              <h5 class="mb-0 fw-bold">Chi ti·∫øt l·ªãch t·∫≠p</h5>
            </div>
            <div class="card-body p-0">
              <div
                th:if="${ptSessions == null or #lists.isEmpty(ptSessions)}"
                class="alert alert-info m-3 text-center"
              >
                <i class="bi bi-info-circle me-2"></i>
                Hu·∫•n luy·ªán vi√™n n√†y ch∆∞a c√≥ bu·ªïi t·∫≠p n√†o ƒë∆∞·ª£c ghi nh·∫≠n.
              </div>

              <div th:if="${ptSessions != null and !#lists.isEmpty(ptSessions)}" class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                  <thead class="table-light">
                    <tr>
                      <th scope="col" style="width: 180px;">Th·ªùi gian</th>
                      <th scope="col">H·ªçc vi√™n</th>
                      <th scope="col" style="width: 150px;">G√≥i t·∫≠p</th>
                      <th scope="col" style="width: 120px;">Bu·ªïi c√≤n l·∫°i</th>
                      <th scope="col">Ghi ch√∫</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr th:each="session : ${ptSessions}">
                      <td>
                        <div class="small">
                          <div class="fw-bold" th:text="${#temporals.format(session.sessionDate.atZoneSameInstant(T(java.time.ZoneId).of('Asia/Ho_Chi_Minh')), 'dd/MM/yyyy')}"></div>
                          <div class="text-muted" th:text="${#temporals.format(session.sessionDate.atZoneSameInstant(T(java.time.ZoneId).of('Asia/Ho_Chi_Minh')), 'HH:mm')}"></div>
                        </div>
                      </td>
                      <td>
                        <div>
                          <div class="fw-bold mb-1" th:text="${session.memberPackage.member.fullName}">H·ªçc vi√™n</div>
                          <div class="small text-muted" th:text="${'üìû ' + session.memberPackage.member.phoneNumber}"></div>
                        </div>
                      </td>
                      <td>
                        <span class="badge bg-primary" th:text="${session.memberPackage.gymPackage.name}">G√≥i PT</span>
                      </td>
                      <td>
                        <span
                          th:if="${session.memberPackage.remainingSessions != null}"
                          th:text="${session.memberPackage.remainingSessions + ' bu·ªïi'}"
                          th:classappend="${session.memberPackage.remainingSessions <= 3 ? 'badge bg-danger' : 'badge bg-success'}"
                          >0 bu·ªïi</span
                        >
                        <span
                          th:if="${session.memberPackage.remainingSessions == null}"
                          class="text-muted small"
                          >-</span
                        >
                      </td>
                      <td>
                        <span
                          th:if="${session.notes != null and !#strings.isEmpty(session.notes)}"
                          th:text="${session.notes}"
                          class="small text-muted"
                          >Ghi ch√∫</span
                        >
                        <span
                          th:if="${session.notes == null or #strings.isEmpty(session.notes)}"
                          class="text-muted small fst-italic"
                          >Kh√¥ng c√≥ ghi ch√∫</span
                        >
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</html>
