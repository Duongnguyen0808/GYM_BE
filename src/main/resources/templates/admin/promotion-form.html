<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<div th:fragment="content">

    <h2 class="mb-4" th:text="${pageTitle}">Tạo Ưu đãi/Khuyến mại</h2>

    <div class="card shadow-sm">
        <div class="card-body">
            <form th:action="@{/admin/promotions/create}" method="post">
                <div class="mb-3">
                    <label class="form-label">Tên ưu đãi</label>
                    <input type="text" name="name" class="form-control" required>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Áp dụng cho</label>
                            <select name="targetType" id="promotionTargetType" class="form-select" required>
                                <option value="PACKAGE">Gói tập</option>
                                <option value="PRODUCT">Sản phẩm</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Giảm (%)</label>
                            <input type="number" step="0.01" min="0" max="100" name="discountPercent" class="form-control" required>
                        </div>
                    </div>
                </div>

                <div class="mb-3" id="promotionPackageSelect">
                    <label class="form-label">Chọn Gói tập</label>
                    <select class="form-select" name="targetId" id="packageDropdown">
                        <option value="">-- Chọn gói --</option>
                        <option th:each="pkg : ${packages}" th:value="${pkg.id}" th:text="${pkg.name}"></option>
                    </select>
                </div>

                <div class="mb-3" id="promotionProductSelect" style="display:none;">
                    <label class="form-label">Chọn Sản phẩm</label>
                    <select class="form-select" name="targetId" id="productDropdown" disabled>
                        <option value="">-- Chọn sản phẩm --</option>
                        <option th:each="prod : ${products}" th:value="${prod.id}" th:text="${prod.name}"></option>
                    </select>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Bắt đầu</label>
                            <input type="datetime-local" name="start" class="form-control" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Kết thúc</label>
                            <input type="datetime-local" name="end" class="form-control" required>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">Tạo</button>
                <a th:href="@{/admin/promotions}" class="btn btn-secondary">Hủy</a>
            </form>
        </div>
    </div>

    <script th:inline="javascript">
        const typeSelect = document.getElementById('promotionTargetType');
        const pkgSel = document.getElementById('promotionPackageSelect');
        const prodSel = document.getElementById('promotionProductSelect');
        const pkgDropdown = document.getElementById('packageDropdown');
        const prodDropdown = document.getElementById('productDropdown');
        
        if (typeSelect) {
            typeSelect.addEventListener('change', function(){
                const v = typeSelect.value;
                if (v === 'PACKAGE') { 
                    pkgSel.style.display='block'; 
                    prodSel.style.display='none'; 
                    pkgDropdown.disabled = false;
                    prodDropdown.disabled = true;
                } else { 
                    pkgSel.style.display='none'; 
                    prodSel.style.display='block'; 
                    pkgDropdown.disabled = true;
                    prodDropdown.disabled = false;
                }
            });
        }
    </script>

</div>

</html>