<!DOCTYPE html>
<html lang="vi" 
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
  <head>
    <meta charset="UTF-8" />
    <title th:text="${pageTitle != null ? pageTitle : 'Hệ thống Quản lý Gym'}">
      Hệ thống Quản lý Gym
    </title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Select2 CSS for searchable dropdowns -->
    <link
      href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css"
      rel="stylesheet"
    />
    <style>
      /* (CSS Giữ nguyên) */
      body {
        min-height: 100vh;
        background-color: #f8f9fa;
      }
      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        bottom: 0;
        width: 260px;
        padding: 60px 0 0;
        box-shadow: 0 2px 5px 0 rgb(0 0 0 / 5%), 0 2px 10px 0 rgb(0 0 0 / 5%);
        z-index: 1000;
        background-color: #fff;
      }
      .sidebar .nav-link {
        color: #333;
        font-weight: 500;
        padding: 10px 20px;
      }
      .sidebar .nav-link.active {
        color: #0d6efd;
        background-color: #e7f1ff;
      }
      .sidebar .nav-link:hover {
        background-color: #f8f9fa;
      }
      .topbar {
        position: fixed;
        top: 0;
        right: 0;
        left: 260px;
        height: 60px;
        background-color: #fff;
        box-shadow: 0 2px 5px 0 rgb(0 0 0 / 5%), 0 2px 10px 0 rgb(0 0 0 / 5%);
        z-index: 1001;
        padding: 0 2rem;
      }
      .main-content {
        margin-left: 260px;
        padding: 80px 2rem 2rem;
      }
    </style>
  </head>
  <body>
    <header class="topbar d-flex justify-content-end align-items-center">
      <form th:action="@{/logout}" method="post" class="d-flex">
        <span class="navbar-text me-3">Xin chào!</span>
        <button class="btn btn-outline-primary" type="submit">Đăng xuất</button>
      </form>
    </header>

    <nav class="sidebar">
      <div
        class="d-flex justify-content-center align-items-center p-3 mb-2 border-bottom"
        style="height: 60px; position: absolute; top: 0; width: 100%"
      >
        <a class="navbar-brand fs-4 fw-bold" th:href="@{/default}">
          <span sec:authorize="hasRole('ADMIN')">GYM ADMIN</span>
          <span sec:authorize="hasRole('PT')">PT DASHBOARD</span>
          <span sec:authorize="hasRole('STAFF')">GYM STAFF</span>
        </a>
      </div>

      <ul class="nav flex-column">
        <!-- Menu cho PT -->
        <th:block sec:authorize="hasRole('PT')">
          <li class="nav-item">
            <a
              class="nav-link"
              th:href="@{/pt/dashboard}"
              th:classappend="${activePage == 'ptDashboard'} ? 'active' : ''"
            >
              Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              th:href="@{/pt/students}"
              th:classappend="${activePage == 'ptStudents'} ? 'active' : ''"
            >
              Danh sách Học viên
            </a>
          </li>
        </th:block>

        <!-- Menu cho Admin và Staff -->
        <th:block sec:authorize="hasAnyRole('ADMIN', 'STAFF')">
          <li
            class="nav-item px-3 py-2 text-muted text-uppercase small"
            style="font-size: 0.75rem"
          >
            Nghiệp vụ
          </li>

          <li class="nav-item">
            <a
              class="nav-link"
              th:href="@{/check-in}"
              th:classappend="${activePage == 'checkIn'} ? 'active' : ''"
            >
              Check-in (Quầy)
            </a>
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              th:href="@{/members}"
              th:classappend="${activePage == 'members'} ? 'active' : ''"
            >
              Quản lý Hội viên
            </a>
          </li>

          <li class="nav-item">
            <a
              class="nav-link"
              th:href="@{/pos}"
              th:classappend="${activePage == 'pos'} ? 'active' : ''"
            >
              Bán hàng tại quầy
            </a>
          </li>
        </th:block>

        <!-- Menu chỉ cho Admin -->
        <th:block sec:authorize="hasRole('ADMIN')">
          <li
            class="nav-item px-3 py-2 mt-3 text-muted text-uppercase small"
            style="font-size: 0.75rem"
          >
            Quản trị
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              th:href="@{/admin/users}"
              th:classappend="${activePage == 'adminUsers'} ? 'active' : ''"
            >
              Quản lý Nhân viên
            </a>
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              th:href="@{/admin/packages}"
              th:classappend="${activePage == 'adminPackages'} ? 'active' : ''"
            >
              Quản lý Gói tập
            </a>
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              th:href="@{/admin/products}"
              th:classappend="${activePage == 'adminProducts'} ? 'active' : ''"
            >
              Quản lý Sản phẩm
            </a>
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              th:href="@{/admin/promotions}"
              th:classappend="${activePage == 'adminPromotions'} ? 'active' : ''"
            >
              Ưu đãi/Khuyến mại
            </a>
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              th:href="@{/admin/reports/sales}"
              th:classappend="${activePage == 'adminReports'} ? 'active' : ''"
            >
              Thống kê
            </a>
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              th:href="@{/admin/pts}"
              th:classappend="${activePage == 'adminPts'} ? 'active' : ''"
            >
              Quản lý PT
            </a>
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              th:href="@{/admin/check-in-logs}"
              th:classappend="${activePage == 'checkInLogs'} ? 'active' : ''"
            >
              Lịch sử Check-in/Check-out
            </a>
          </li>
        </th:block>
      </ul>
    </nav>

    <main class="main-content">
      <div
        th:replace="~{${contentView} :: content}"
        th:if="${contentView != null}"
      >
        <h1>Chào mừng!</h1>
        <p>Vui lòng chọn một chức năng từ thanh điều hướng bên trái.</p>
      </div>
      <div th:if="${contentView == null}" class="alert alert-warning">
        Không có nội dung để hiển thị.
      </div>
    </main>

    <!-- jQuery (required for Select2 and other plugins) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Select2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  </body>
</html>
