<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
  <div th:fragment="content">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="mb-0">Danh s√°ch H·ªçc vi√™n</h2>
      <div>
        <a th:href="@{/pt/dashboard}" class="btn btn-outline-secondary">‚Üê V·ªÅ Dashboard</a>
      </div>
    </div>

    <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
    <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

    <!-- Th·ªëng k√™ -->
    <div class="row mb-4">
      <div class="col-md-4">
        <div class="card shadow-sm">
          <div class="card-body">
            <h5 class="card-title text-muted">T·ªïng h·ªçc vi√™n</h5>
            <h2 class="text-primary" th:text="${stats.totalStudents}">0</h2>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card shadow-sm">
          <div class="card-body">
            <h5 class="card-title text-muted">H·ªçc vi√™n ƒëang theo</h5>
            <h2 class="text-success" th:text="${stats.activeStudents}">0</h2>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card shadow-sm">
          <div class="card-body">
            <h5 class="card-title text-muted">T·ªïng bu·ªïi c√≤n l·∫°i</h5>
            <h2 class="text-info" th:text="${stats.totalRemainingSessions}">0</h2>
          </div>
        </div>
      </div>
    </div>

    <!-- B·∫£ng danh s√°ch h·ªçc vi√™n -->
    <div class="card shadow-sm">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0">Danh s√°ch H·ªçc vi√™n</h5>
      </div>
      <div class="card-body">
        <div th:if="${students == null or students.isEmpty()}" class="text-muted text-center py-4">
          Ch∆∞a c√≥ h·ªçc vi√™n n√†o
        </div>
        <div th:if="${students != null and !students.isEmpty()}" class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>H·ªç t√™n</th>
                <th>S·ªë ƒëi·ªán tho·∫°i</th>
                <th>G√≥i t·∫≠p</th>
                <th>Khung gi·ªù</th>
                <th>C√°c th·ª©</th>
                <th>Bu·ªïi c√≤n l·∫°i</th>
                <th>Ng√†y h·∫øt h·∫°n</th>
                <th>Thao t√°c</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="student : ${students}">
                <td th:text="${student.memberName}">T√™n</td>
                <td th:text="${student.phoneNumber}">SƒêT</td>
                <td>
                  <span class="badge bg-primary" th:text="${student.packageName}">G√≥i</span>
                </td>
                <td th:text="${student.timeSlotDisplay}">Time Slot</td>
                <td>
                  <th:block th:if="${student.allowedWeekdaysDisplay != null and student.allowedWeekdaysDisplay != '-'}">
                    <div class="d-inline-flex align-items-center gap-1 px-2 py-1 rounded" 
                         style="background-color: #f0f4ff; border: 1px solid #c7d2fe;">
                      <span class="text-muted small" style="font-size: 0.75rem;">üìÖ</span>
                      <span class="text-primary fw-semibold" style="font-size: 0.85rem; letter-spacing: 0.5px;">
                        <th:block th:with="days=${#strings.arraySplit(student.allowedWeekdaysDisplay, ', ')}">
                          <th:block th:each="day,iterStat : ${days}">
                            <th:block th:with="dayTrimmed=${day.trim()}">
                              <span th:if="${dayTrimmed.startsWith('Th·ª© ')}" th:text="${dayTrimmed.substring(5)}">2</span>
                              <span th:unless="${dayTrimmed.startsWith('Th·ª© ')}" th:text="${dayTrimmed}">CN</span>
                            </th:block>
                            <span th:if="${!iterStat.last}">, </span>
                          </th:block>
                        </th:block>
                      </span>
                    </div>
                  </th:block>
                  <span th:if="${student.allowedWeekdaysDisplay == null or student.allowedWeekdaysDisplay == '-'}" class="text-muted">-</span>
                </td>
                <td>
                  <span class="badge bg-warning" th:text="${student.remainingSessions}">0</span>
                </td>
                <td th:text="${student.endDate != null ? #temporals.format(student.endDate, 'dd/MM/yyyy') : '-'}">Ng√†y</td>
                <td>
                  <a th:href="@{/pt/students/{id}(id=${student.packageId})}" class="btn btn-sm btn-primary">Chi ti·∫øt</a>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</html>


